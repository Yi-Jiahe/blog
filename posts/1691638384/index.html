<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=HandheldFriendly content="True"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta http-equiv=Cache-Control content="no-transform"><meta http-equiv=Cache-Control content="no-siteapp"><meta name=generator content="Hugo 0.145.0"><link rel="shortcut icon" href=https://cdn.jsdelivr.net/gh/dsrkafuu/dsr-cdn-main@1/images/favicons/dsrca.ico><title>SQLite3 and Go - Jiahe's Blog</title>
<meta name=keywords content="Golang"><meta property="og:title" content="SQLite3 and Go"><meta name=twitter:title content="SQLite3 and Go"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.jiahe.dev/posts/1691638384/"><meta property="og:description" content="The issue
Using SQLite with go using using the mattn/go-sqlite3 module requires cgo which in turn requires gcc and complicates cross-compliation.
If developing on Windows, gcc needs to be installed which can be quite the ordeal.
If using multistage builds in Docker, care needs to be taken to ensure that the architecture matches the final stage. I encounted an issue when using the default golang image which is a Debian image to build for a final Alpine image."><meta name=twitter:description content="The issue
Using SQLite with go using using the mattn/go-sqlite3 module requires cgo which in turn requires gcc and complicates cross-compliation.
If developing on Windows, gcc needs to be installed which can be quite the ordeal.
If using multistage builds in Docker, care needs to be taken to ensure that the architecture matches the final stage. I encounted an issue when using the default golang image which is a Debian image to build for a final Alpine image."><meta name=twitter:card content="summary"><meta property="article:published_time" content="2023-08-10T03:33:04+00:00"><meta property="article:modified_time" content="2023-08-10T03:33:04+00:00"><style>@media(prefers-color-scheme:dark){body[data-theme=auto] img{filter:brightness(60%)}}body[data-theme=dark] img{filter:brightness(60%)}</style><link rel=stylesheet href=https://blog.jiahe.dev/assets/css/fuji.min.b4a21b5d3eb1d0a51297e31230a65fc25e387843e45ec3a2d9176cd8d163c216d99b9b13a618b28f537c3b559ec8a408183b0fbfad48daddb9befa7d3ef90eed.css integrity="sha512-tKIbXT6x0KUSl+MSMKZfwl44eEPkXsOi2Rds2NFjwhbZm5sTphiyj1N8O1WeyKQIGDsPv61I2t25vvp9PvkO7Q=="><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YVT3MYYQLK")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YVT3MYYQLK"></script></head><body data-theme=auto data-theme-auto=false><script data-cfasync=false>var fujiThemeData=localStorage.getItem("fuji_data-theme");fujiThemeData?fujiThemeData!=="auto"&&document.body.setAttribute("data-theme",fujiThemeData==="dark"?"dark":"light"):localStorage.setItem("fuji_data-theme","auto")</script><header></header><main><div class="container-lg clearfix"><div class="col-12 col-md-9 float-left content"><article><h1 class="post-item post-title"><a href=https://blog.jiahe.dev/posts/1691638384/>SQLite3 and Go</a></h1><div class="post-item post-meta"><span><i class="iconfont icon-today-sharp"></i>&nbsp;2023-08-10</span>
<span><i class="iconfont icon-pricetags-sharp"></i>&nbsp;<a href=/tags/golang>Golang</a>&nbsp;</span></div><div class="post-content markdown-body"><h2 id=the-issue>The issue</h2><p>Using SQLite with go using using the mattn/go-sqlite3 module requires cgo which in turn requires gcc and complicates cross-compliation.</p><p>If developing on Windows, gcc needs to be installed which can be quite the ordeal.</p><p>If using multistage builds in Docker, care needs to be taken to ensure that the architecture matches the final stage. I encounted an issue when using the default golang image which is a Debian image to build for a final Alpine image.</p><p>At first I tried adding <code>apk add --no-cache libc6-compat</code> to my final image as suggesteed by <a href=https://stackoverflow.com/questions/51508150/standard-init-linux-go190-exec-user-process-caused-no-such-file-or-directory#comment117747592_62123648 target=_blank>https://stackoverflow.com/questions/51508150/standard-init-linux-go190-exec-user-process-caused-no-such-file-or-directory#comment117747592_62123648</a>.
However this resulted in <code>fcntl64: symbol not found</code>.
Unfortunately, I was unable to find a resolution for this issue.</p><p>What I decided to do, was to download the go and gcc toolchain into an alpine build image to build for alpine, as suggested by <a href=https://megamorf.gitlab.io/2019/09/08/alpine-go-builds-with-cgo-enabled/ target=_blank>https://megamorf.gitlab.io/2019/09/08/alpine-go-builds-with-cgo-enabled/</a>.</p><h2 id=sqlite3-in-go>Sqlite3 in Go</h2><p>There exists a cgo-free port of SQLite in Go, modernc.org/sqlite which can be used to avoid this issue.</p><p>One of the comparisions between the two is in speed as tested by <a href=https://datastation.multiprocess.io/blog/2022-05-12-sqlite-in-go-with-and-without-cgo.html target=_blank>https://datastation.multiprocess.io/blog/2022-05-12-sqlite-in-go-with-and-without-cgo.html</a>.
But given my intended usage of the database, I&rsquo;m not particularly worried about the performance.</p></div></article><div class=post-comment data-comment=mastodon><span class=post-comment-notloaded><i class="iconfont icon-chatbox-ellipses-sharp"></i>&nbsp;Load comments
</span><script>async function get_statuses_with_context(e,t){const n=`https://${e}/api/v1/statuses/${t}/context`,s=await fetch(n);return await s.json()}async function get_status(e,t){const n=`https://${e}/api/v1/statuses/${t}`,s=await fetch(n);return await s.json()}function insert_comment(e,t){let n=[e[0]];for(;n;){let e=n.pop();if(t.in_reply_to_id==e.id)return e.replies.push({...t,replies:[]}),!0;n.push(...e.replies)}return!1}function process_descendants(e){const n=[{id:"114079249884710318",replies:[]}];let t=e;for(;!0;){let e=[];for(let s=0;s<t.length;s++){const o=t[s];if(insert_comment(n,o))continue;e.push(o)}if(t.length==e.length)break;t=e}return n[0].replies}function render_comments(e){return e.map(e=>{const i=new Date(e.created_at),t=(Date.now()-i.getTime())/1e3;let n;t<60?n=`${Math.floor(t)} seconds ago`:t<3600?n=`${Math.floor(t/60)} minutes ago`:t<86400?n=`${Math.floor(t/3600)} hours ago`:n=`${Math.floor(t/86400)} days ago`;const s=document.createElement("div");s.style.padding="10px";let o=`
          <p>
            <a href="${e.account.url}"><span>${e.account.display_name}</span></a>
            <a href="${e.url}"><span>${n}</span></a>
          </p>
          <div>${e.content}<div>
          <a href="${e.url}"><span style="text-decoration: underline;font-size: 0.8em">Reply</span></a>
        `;if(e.replies.length>0){const t=render_comments(e.replies);o+=`
            <div style="display:flex">
              <div style="padding:10px"></div>
              <div>
                ${t.map(e=>e.outerHTML)}
              </div>
            </div>
        `}return s.innerHTML=o,s})}async function loadComment(){const s="mastodon.social",o="114079249884710318";let t=await get_statuses_with_context(s,o);const r=process_descendants(t.descendants);let e=document.querySelector(".post-comment");e.style.padding="10px",t=await get_status(s,o);const i=t.url,n=document.createElement("a");n.href=i,n.innerHTML=`<button>Reply</button>`,e.appendChild(n);const a=render_comments(r);a.length===0?e.appendChild(document.createElement("p")).innerHTML=`
        <div style="text-align: center">
          <p>No comments yet...</p>
          <p>Be the first to <a href=${i}>reply</a>!</p>
        </div>
      `:a.forEach(t=>e.appendChild(t)),document.querySelector("span.post-comment-notloaded").setAttribute("style","display: none;")}</script></div></div><aside class="col-12 col-md-3 float-left sidebar"><div class="sidebar-item sidebar-pages"><h3>Pages</h3><ul></ul></div><div class="sidebar-item sidebar-toc"><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#the-issue>The issue</a></li><li><a href=#sqlite3-in-go>Sqlite3 in Go</a></li></ul></nav></div></aside></div><div class=btn><div class=btn-menu id=btn-menu><i class="iconfont icon-grid-sharp"></i></div><div class=btn-toggle-mode><i class="iconfont icon-contrast-sharp"></i></div><div class=btn-scroll-top><i class="iconfont icon-chevron-up-circle-sharp"></i></div></div><aside class=sidebar-mobile style=display:none><div class=sidebar-wrapper><div class="sidebar-item sidebar-pages"><h3>Pages</h3><ul></ul></div><div class="sidebar-item sidebar-links"><h3>Links</h3><ul></ul></div><div class="sidebar-item sidebar-tags"><h3>Tags</h3><div><span><a href=/tags/3d-printing/>3D Printing</a>
</span><span><a href=/tags/audio/>Audio</a>
</span><span><a href=/tags/cloud/>Cloud</a>
</span><span><a href=/tags/devlog/>Devlog</a>
</span><span><a href=/tags/drone/>Drone</a>
</span><span><a href=/tags/electronics/>Electronics</a>
</span><span><a href=/tags/embedded/>Embedded</a>
</span><span><a href=/tags/golang/>Golang</a>
</span><span><a href=/tags/java/>Java</a>
</span><span><a href=/tags/keyboards/>Keyboards</a>
</span><span><a href=/tags/meta/>Meta</a>
</span><span><a href=/tags/python/>Python</a>
</span><span><a href=/tags/tentatwo/>TentaTwo</a>
</span><span><a href=/tags/wearable-tech/>Wearable Tech</a>
</span><span><a href=/tags/web/>Web</a>
</span><span><a href=/tags/web-app/>Web App</a></span></div></div></div></aside></main><footer><div class="container-lg clearfix"><div class="col-12 footer"><span>&copy; 2025
<a href=https://blog.jiahe.dev/></a>| Powered by <a href=https://github.com/andrew-aiken/hugo-theme-fuji/ target=_blank>Fuji</a> & <a href=https://gohugo.io/ target=_blank>Hugo</a></span></div></div></footer><script defer src=https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js integrity="sha512-q583ppKrCRc7N5O0n2nzUiJ+suUv7Et1JGels4bXOaMFQcamPk9HjdUknZuuFjBNs7tsMuadge5k9RzdmO+1GQ==" crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.27.0/components/prism-core.min.js integrity="sha512-LCKPTo0gtJ74zCNMbWw04ltmujpzSR4oW+fgN+Y1YclhM5ZrHCZQAJE4quEodcI/G122sRhSGU2BsSRUZ2Gu3w==" crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.27.0/plugins/autoloader/prism-autoloader.min.js integrity="sha512-GP4x8UWxWyh4BMbyJGOGneiTbkrWEF5izsVJByzVLodP8CuJH/n936+yQDMJJrOPUHLgyPbLiGw2rXmdvGdXHA==" crossorigin=anonymous></script><script defer src=/assets/js/fuji.min.645f1123be695831f419ab54c1bcba327325895c740014006e57070d4f3e5d6b553e929c4b46f40ea707249e9c7f7c2a446d32a39ce7319f80a34525586a8e0f.js integrity="sha512-ZF8RI75pWDH0GatUwby6MnMliVx0ABQAblcHDU8+XWtVPpKcS0b0DqcHJJ6cf3wqRG0yo5znMZ+Ao0UlWGqODw=="></script></body></html>